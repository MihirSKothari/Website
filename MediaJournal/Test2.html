<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Media Journal Viewer</title>
  <style>
    body { font-family: sans-serif; background: #222; color: #eee; max-width: 800px; margin: 2em auto; padding: 1em; }
    h2 { border-bottom: 1px solid #555; padding-bottom: 0.3em; }
    .entry { display: flex; margin: 1em 0; background: #333; border-radius: 8px; overflow: hidden; }
    .entry img { width: 120px; height: 180px; object-fit: cover; }
    .info { padding: 0.8em; flex: 1; }
    .title { font-weight: bold; font-size: 1.2em; margin-bottom: 0.5em; }
    .date { font-style: italic; color: #aaa; }
  </style>
</head>
<body>
  <h1>Media Journal</h1>

  <h2>Watched</h2>
  <div id="watchedList"></div>

  <h2>To Watch</h2>
  <div id="toWatchList"></div>

<script>
  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzy7xTfb_uUN5QbOZrici11BFTVq2NIVEbObdt0hmgppYtUkl7K8Fs7nET-IuxHUHnVnA/exec'; // Replace with your deployed Apps Script URL

  async function loadMediaJournal() {
    try {
      const response = await fetch(APPS_SCRIPT_URL);
      if (!response.ok) throw new Error('Failed to fetch media data');
      const items = await response.json();

      items.forEach(item => {
        // Create entry element
        const div = document.createElement('div');
        div.className = 'entry';

        const posterUrl = item.poster || '';
        const title = item.title || 'No Title';
        const timestamp = item.timestamp ? new Date(item.timestamp).toLocaleString() : 'Unknown date';

        div.innerHTML = `
          <img src="${posterUrl}" alt="${title} poster" />
          <div class="info">
            <div class="title">${title}</div>
            <div class="date">Added: ${timestamp}</div>
          </div>
        `;

        // Append to watched or toWatch section based on sheet checkbox values
        if (item.watched === true || item.watched === 'TRUE' || item.watched === 'true') {
          document.getElementById('watchedList').appendChild(div);
        } else if (item.toWatch === true || item.toWatch === 'TRUE' || item.toWatch === 'true') {
          document.getElementById('toWatchList').appendChild(div);
        }
      });
    } catch (error) {
      console.error('Error loading media journal:', error);
      const msg = document.createElement('p');
      msg.textContent = 'Failed to load media data. Please try again later.';
      document.body.appendChild(msg);
    }
  }

  // Load media journal on page load
  loadMediaJournal();
</script>
</body>
</html>
